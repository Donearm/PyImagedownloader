#!/usr/bin/env python2
# -*- coding: utf-8 -*-

import unittest
import pixroute
import lxml.html

class TestPixroute(unittest.TestCase):

    def setUp(self):
        self.basedir = '/mnt/documents/Maidens/Uploads/'
        self.url = 'http://www.pixroute.com/s4tx57g1po5v/Ana_Ivanovic_En_Bikini_Le_15-01-11_1.jpg.html'
        self.example_pr_page = """<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
<Title>Pix Route - Fast and Reliable Image Hosting - Download Ana Ivanovic Bikini jpg</Title>
<link rel="stylesheet" type="text/css" href="http://www.pixroute.com/main.css">
<script language="JavaScript" type="text/javascript" CHARSET="UTF-8" src="http://www.pixroute.com/xupload.js"></script>
<META http-equiv=Content-Type content="text-html; charset=UTF-8">
<META NAME="description" CONTENT="Download File Ana Ivanovic Bikini jpg">
<META NAME="keywords"    CONTENT="ana, ivanovic, bikini, jpg">

<link rel="stylesheet" href="http://www.pixroute.com/sysmax/dhtmlwindow.css" type="text/css" />
<script language="JavaScript" type="text/javascript" src="http://www.pixroute.com/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="http://www.pixroute.com/sysmax/dhtmlwindow.js">
</script>

<link rel="stylesheet" href="http://www.pixroute.com/winbro/modal.css" type="text/css" />
<script type="text/javascript" src="http://www.pixroute.com/winbro/modal.js"></script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-10568599-3']);
  _gaq.push(['_setDomainName', 'none']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


</HEAD>
<BODY>

<Center>

<div class="fr4me">


<div style="position:relative;width:332px;margin-bottom:15px;">

<a href="http://www.pixroute.com"><img src="http://www.pixroute.com/images/logo.jpg" border=0 alt="Pix Route" title="Pix Route"></a>


</div>








<a href="http://www.pixroute.com/login.html"><b>Login</b></a>&nbsp; &nbsp;
<a href="http://www.pixroute.com/?op=registration"><b>Sign Up</b></a>&nbsp; &nbsp;

<a href="http://www.pixroute.com/?op=forgot_pass">Forgot your password?</a>
<br>



<br>

<div id="modalalertdiv" style="display:none;">

<div style="background: #F3F3F3; height: 100%; padding: 5px">
<p>Welcome to Imageporter. Please click on the continue button to view the requested image.(You will not see this message more than once in same browsing session.)</p>
<center>
<form id="agecheck">
<input type="button" value="CONTINUE" style="margin-right: 20px" onClick="xcvdesdc()" /> 
</form></center>

</div>

</div>

<script type="text/javascript">
_gaq.push(['_trackPageview', 'usrpage7']);
</script>

<script type="text/javascript">
var coox = readCookie('pixnon11');
function createCookie(name,value,days) {
    if (days) {
        var date = new Date();
        date.setTime(date.getTime()+(days*20*60*1000));
        var expires = "; expires="+date.toGMTString();
    }
    else var expires = "";
    document.cookie = name+"="+value+expires+"; path=/";
}

function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function eraseCookie(name) {
    createCookie(name,"",-1);
}
if(coox)
 {
    }

else
{

    agewindow=dhtmlmodal.open('agebox', 'div', 'modalalertdiv', 'Continue', 'width=350px,height=120,center=1,resize=0,scrolling=0')

function xcvdesdc() {
createCookie('pixnon11','1',1);
agewindow.hide();
_gaq.push(['_trackPageview', 'usrclick7']);
}

}


    

</script>

<script type="text/javascript"> 
//default pop-under house ad url 
infinityads_enable_pop = true; 
infinityads_frequencyCap =0.1;
durl = '';
infinityads_layer_border_color = '';
infinityads_layer_ad_bg = '';
infinityads_layer_ad_link_color = '';
infinityads_layer_ad_text_color = '';
infinityads_text_link_bg = '';
infinityads_text_link_color = '';
infinityads_enable_text_link = false
infinityads_enable_layer_pop = false;
</script>
 <script type="text/javascript" src="http://ads.lzjl.com/newServing/showAd.php?nid=5&pid=4655&adtype=&sid=7347"></script>

 
  

<Form name="ciolsha" method="POST" action="" onSubmit="if($('btn_download').disabled)return false;$('btn_download').value='Sending File...';$('btn_download').disabled=true;return true;">
<input type="hidden" name="op" value="download2">
<input type="hidden" name="id" value="s4tx57g1po5v">
<input type="hidden" name="rand" value="tlwxkkpvsiarywoh6ksv3syehk2pctp3hlvtxha">
<input type="hidden" name="referer" value="forum.phun.org/showthread.php?t=614083">

<input type="hidden" name="method_free" value="">
<input type="hidden" name="method_premium" value="">

<table class="file_slot" cellpadding=0 cellspacing=3 width=360>
<tr><td align=right><b>Filename:</b></td><td nowrap>Ana_Ivanovic_En_Bikini_Le_15-01-11_1.jpg</td></tr>
<tr><td align=right><b>Size:</b></td><td>48 Kb <small>(48886 bytes)</small>

&nbsp; <a href="http://www.pixroute.com/?op=report_file;id=s4tx57g1po5v">Report abuse</a>
</td></tr>





</table>













</Form>
<br>
<center>

<script type="text/javascript">
clicksor_enable_adhere = false;
//default pop-under house ad url
clicksor_enable_pop = true; clicksor_frequencyCap = -1;
durl = '';clicksor_enable_layer_pop = false;
//default banner house ad url 
clicksor_default_url = '';
clicksor_banner_border = '#99CC33'; clicksor_banner_ad_bg = '#FFFFFF';
clicksor_banner_link_color = '#000000'; clicksor_banner_text_color = '#666666';
clicksor_banner_image_banner = true; clicksor_banner_text_banner = true;
clicksor_layer_border_color = '';
clicksor_layer_ad_bg = ''; clicksor_layer_ad_link_color = '';
clicksor_layer_ad_text_color = ''; clicksor_text_link_bg = '';
clicksor_text_link_color = ''; clicksor_enable_text_link = false;
</script>
<script type="text/javascript" src="http://ads.clicksor.com/showAd.php?nid=1&amp;pid=92302&amp;adtype=1&amp;sid=273592&amp;zone=23789"></script>

    </center>

<br>

 <script type="text/javascript"> function loodfic() { var ujhz1oo = document.getElementById("ujhz1oo"); if(ujhz1oo.width>800) {w=ujhz1oo.width; h=ujhz1oo.height;wn = 800;hn = parseInt(ujhz1oo.height*800/ujhz1oo.width);ujhz1oo.width  = wn;ujhz1oo.height = hn;return;}else{ujhz1oo.width=w;ujhz1oo.height=h;return;}}</script><br><center><div><A HREF="javascript:loodfic()" ><img src="http://img127.pixroute.com/i/00036/s4tx57g1po5v.jpg" id="ujhz1oo" ></A></div></center>
<br>

<center>

          


<table border=0>
 <tr>
  <td width=319 valign=top>
<!-- BEGIN STANDARD TAG - 300 x 250 - ROS: Run-of-site - DO NOT MODIFY -->

<IFRAME FRAMEBORDER=0 MARGINWIDTH=0 MARGINHEIGHT=0 SCROLLING=NO WIDTH=300 HEIGHT=250 SRC="http://ad.globaltakeoff.net/st?ad_type=iframe&ad_size=300x250&section=1287064"></IFRAME>
<!-- END TAG -->
  </td>
  <td width=319 valign=top>
 <!-- BEGIN STANDARD TAG - 300 x 250 - ROS: Run-of-site - DO NOT MODIFY -->
<IFRAME FRAMEBORDER=0 MARGINWIDTH=0 MARGINHEIGHT=0 SCROLLING=NO WIDTH=300 HEIGHT=250 SRC="http://ad.globaltakeoff.net/st?ad_type=iframe&ad_size=300x250&section=1287064"></IFRAME>
<!-- END TAG -->
  </td>
 </tr>
</table>



</center>



<Script type="text/javascript" language="JavaScript">

function checkForm(ciolsha)
{
    if(ciolsha.cmt_name && ciolsha.cmt_name.value==''){alert("Name is required field");return false;}
    if(ciolsha.cmt_email && ciolsha.cmt_email.value==''){alert("Valid e-mail required");return false;}
    if(ciolsha.cmt_text.value.length<5){alert("Too short comment text");return false;}
    return true;
}
</Script>



<table cellspacing=0 cellpadding=3 class="result_slot">

<tr>
    <td align=right><b>Code for forums:</b></td>

    <td colspan=2>
<textarea id="ic1-180898" style="width:480px;" rows=3 onFocus="copy(this);">[URL=http://www.pixroute.com/s4tx57g1po5v/Ana_Ivanovic_En_Bikini_Le_15-01-11_1.jpg.html][IMG]http://img127.pixroute.com/i/00036/s4tx57g1po5v_t.jpg[/IMG][/URL]</textarea>
<div id="c1-180898" class="btndiv">copy</div>
    </td>
</tr>
<tr>
    <td align=right><b>HTML for Websites:</b></td>
    <td colspan=2>
<textarea id="ic2-180898" style="width:480px;" rows=3 onFocus="copy(this);"><a href="http://www.pixroute.com/s4tx57g1po5v/Ana_Ivanovic_En_Bikini_Le_15-01-11_1.jpg.html"><img src="http://img127.pixroute.com/i/00036/s4tx57g1po5v_t.jpg" border=0></a></textarea>

<div id="c2-180898" class="btndiv">copy</div>
    </td>
</tr>
<tr>
    <td align=right><b>Show image to friends:</b></td>
    <td colspan=2>
<textarea id="ic3-180898" style="width:480px;" rows=3 onFocus="copy(this);">http://www.pixroute.com/s4tx57g1po5v/Ana_Ivanovic_En_Bikini_Le_15-01-11_1.jpg.html</textarea>
<div id="c3-180898" class="btndiv">copy</div>
    </td>

</tr>

</table>
<br>







<br>
<div style="width:500px;text-align:left;" class="sinput">

<a name="comments"></a>

<div id="cnew"></div>

<center><a href="#" onClick="$$('cmt_form').style.display='block';this.style.display='none';return false;">Comment on this</a></center>

<div id="cmt_form" style="display:none">
<Form method="POST" action="http://www.pixroute.com/" onSubmit="return submitCommentsForm(this)">
<h3>Leave a Reply</h3>
<input type="hidden" name="cmt_type" value="1">
<input type="hidden" name="cmt_ext_id" value="180898">

<input type="text" name="name" value="" style="display:none">
<input type="text" name="cmt_name" value="" size=18><b>Name</b> <small>(required)</small><br>
<input type="text" name="email" value="" style="display:none">

<input type="text" name="cmt_email" value="" size=24><b>E-mail</b> <small>(will not be published)</small><br>

<Textarea name="text" style="width:100%;display:none;" cols=24 rows=3></Textarea>
<Textarea name="cmt_text" style="width:100%;display:block;" cols=24 rows=3 id='cmt_txt'></Textarea>
<input type="submit" value="Leave a Reply">
</Form>
</div>


</div>






<br>
<Table class="tbl1" cellpadding=2 cellspacing=1 width=500>
<TR class="hdr"><TD colspan=2>More Images Like Above One</TD></TR>

<TR><TD><a href="http://www.pixroute.com/x9dyfguosh4z/Ana_Ivanovic_En_Bikini_Le_15-01-11_2.jpg.html">Ana Ivanovic En Bikini Le 15-01-11 2.jpg</a></TD><TD width="1%" nowrap align=right>70.7 Kb</TD></TR>

<TR><TD><a href="http://www.pixroute.com/mpysjlsjme1c/Ana_Ivanovic_En_Bikini_Le_15-01-11_3.jpg.html">Ana Ivanovic En Bikini Le 15-01-11 3.jpg</a></TD><TD width="1%" nowrap align=right>58.9 Kb</TD></TR>

<TR><TD><a href="http://www.pixroute.com/nc82qbpt3xx2/Ana_Ivanovic_En_Bikini_Le_15-01-11_8.jpg.html">Ana Ivanovic En Bikini Le 15-01-11 8.jpg</a></TD><TD width="1%" nowrap align=right>70.3 Kb</TD></TR>

<TR><TD><a href="http://www.pixroute.com/x9czidpdcnm3/Ana_Ivanovic_En_Bikini_Le_15-01-11_9.jpg.html">Ana Ivanovic En Bikini Le 15-01-11 9.jpg</a></TD><TD width="1%" nowrap align=right>46.5 Kb</TD></TR>

</Table>


<script type="text/javascript" src="http://www.pixroute.com/ZeroClipboard.js"></script>
<script type="text/javascript" language="JavaScript">
function init(fid)
{
    ZeroClipboard.setMoviePath( 'http://www.pixroute.com/ZeroClipboard.swf' );
    clip = new ZeroClipboard.Client();
    clip.setHandCursor( true );
    clip.addEventListener( 'onComplete', function(client) { afterCopy() } );

    list = document.getElementsByTagName('div');
    clip_curr='';

    for(i=0;i<list.length;i++)
    {
        if(list[i].className=='btndiv')
        {
            list[i].onmouseover = function()
            {
                clip.setText( $$('i'+this.id).value );
                clip_curr=this.id;
                if (clip.div) {
                    clip.receiveEvent('mouseout', null);
                    clip.reposition(this);
                }
                else clip.glue(this);
                clip.receiveEvent('mouseover', null);
            }
        }
    }
}
function afterCopy(btn)
{
    list = document.getElementsByTagName('div');
    for(i=0;i<list.length;i++)
    {
        if(list[i].className=='btndiv')
        {
            list[i].innerHTML='copy';
        }
    }
    $$(clip_curr).innerHTML='copied';
}

window.onload=function(){init();}
</script>


<!-- GoStats JavaScript Based Code -->
<script type="text/javascript" src="http://gostats.com/js/counter.js"></script>
<script type="text/javascript">_gos='gostats.com';_goa=746882;
_got=5;_goi=1;_gol='site stats';_GoStatsRun();</script>
<noscript><a target="_blank" title="site stats" 
href="http://gostats.com"><img alt="site stats" 
src="http://gostats.com/bin/count/a_746882/t_5/i_1/counter.png" 
style="border-width:0" /></a></noscript>
<!-- End GoStats JavaScript Based Code -->



<br>

<div style="color:#444;font-size:12px;">
Copyright &copy; 2010 Pix Route, All Rights Reserved.

</div>

<div style="margin:3px 0 10px 0;">
<a href="http://www.pixroute.com">Home</a> | 
<a href="http://www.pixroute.com/faq.html">FAQ</a> | 
<a href="http://www.pixroute.com/tos.html">Terms of service</a> | 
<a href="http://www.pixroute.com/links.html">Links</a> | 
<a href="http://www.pixroute.com/contact.html">Contact Us</a>

</div>
</Center>


</BODY>
</HTML>"""
        self.pr = pixroute.PixrouteParse(self.url, self.basedir)

    def test_process_url(self):
        self.page = self.pr.process_url(self.url)
        self.assertIsInstance(self.page, lxml.html.HtmlElement)

    def test_pixroute_get_image_src_and_name(self):
        self.pixroute_src, self.imagename  = self.pr.pixroute_get_image_src_and_name(lxml.html.fromstring(self.example_pr_page))
        self.assertIsInstance(self.pixroute_src, list)
        self.assertTrue(self.pixroute_src[0])
        self.assertIsInstance(self.imagename, str)

    def test_pixroute_save_image(self):
        #TODO: how to test this?
        pass


def main():
    suite = unittest.TestLoader().loadTestsFromTestCase(TestPixroute)
    unittest.TextTestRunner(verbosity=2).run(suite)

main()
